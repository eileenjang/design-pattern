# 디자인 패턴 소개와 전략 패턴

- 디자인 패턴?

    - 소프트웨어 디자인 과정에서 자주 발생하는 문제들에 대한 일반적인 해결책

- 누군가가 이미 여러분의 문제를 `해결`해 놓았습니다.

    - 1장에서는 다른 개발자가 여러분과 똑같은 문제를 경험하고 해결하면서 익혔던 지혜와 교훈들을 살펴보고, 그것들을 어떻게 활용할 수 있는지를 배웁니다.
    - 우선 디자인 패턴의 `활용 분야`와 디자인 패턴으로 얻을 수 있는 `장점`을 알아봅니다.
    - 핵심적인 `객체지향 디자인 원칙`을 살펴본 후, 한 가지 패턴을 정해 디자인 원칙이 어떤 식으로 작동하는지 알아보겠습니다.
    - 패턴을 잘 사용하려면, 패턴을 머릿속에 집어넣은 다음 -> 애플리케이션에 어떻게 적용할지를 파악해야 합니다.
    - 디자인 패턴은 코드가 아닌 `경험`을 재사용하는 것이니까요.

## 오리 시뮬레이션 게임, SimUDuck

- 조는 SimUDuck 이라는 오리 시뮬레이션을 만드는 회사에 다니고 있다.
- 게임에는 헤엄도 치고, 꽥꽥 소리도 내는 매우 다양한 오리가 등장한다.
- 시스템을 처음 디자인한 사람은, Duck이라는 슈퍼클래스를 만든 다음, 그 클래스를 확장해서 서로 다른 종류의 오리를 만들었다.

## 오리 시뮬레이션 게임 차별화하기

- 이제 오리들이 날아다닐 수 있도록 해야 한다는 임원진들의 결정이 내려졌다.
- `Duck` 클래스에 `fly()` 메소드만 추가하면 모든 오리가 그걸 상속받게 만들었다.

## 경고! 심각한 문제 발생

- 조는 Duck의 몇몇 서브클래스만 날아야 한다는 사실을 깜빡했다.
  - Duck이라는 슈퍼클래스에 fly() 메소드를 추가하면서 일부 서브클래스에 적합하지 않은 행동이 추가된 것.
- 그러나 유지보수 관점에서 상속은 좋은 방법이 아니였다.

## 상속을 생각하기

- fly() 메소드도 오버라이드 하면 되는 것?
- RubberDuck 이라는 날수도 소리낼 수도 없어야 하는 새로운 클래스 추가

## 인터페이스 설계하기

- `상속`은 옳은 방법이 아니였다.
- 상속을 계속 활용한다면 규격이 바뀔 때마다 프로그램에 추가했던 Duck의 서브클래스 fly() 와 quark() 메소드를 일일이 살펴보고 오버라이드 해야하기 때문.
- `fly()` 와 `quark()` 에 해당하는 각각의 인터페이스를 만들어서 서브클래스에서 구현할 수 있긴 하지만, `코드 중복`으로 관리가 힘들다.

## 해결 방법 고민하기

- 모든 서브클래스에 날거나 꽥꽥거리는 기능이 있어야 하는 건 아니므로 상속은 올바른 방법이 아니다.
- 서브클래스에서 Flyable, Quarkable을 구현해서 일부 문제를 해결할 수는 있지만, 코드 관리에 문제가 생긴다.
- 날 수 있는 오리들 중에서도 날아다니는 방식이 서로 다르다는 문제도 있다.
- 객체지향 소프트웨어 디자인 원칙을 적용해보자.

## 소프트웨어 개발 불편의 진리

- 아무리 디자인을 잘한 애플리케이션이라도 시간이 지남에 따라 변화하고 성장해야 한다.
- 그렇지 않으면 애플리케이션은 죽고 만다.

## 문제를 명확하게 파악하기

- 디자인 원칙
  - 애플리케이션에서 달라지는 부분을 찾아내고, 달라지지 않는 부분과 분리한다.
  - 달라지는 부분을 찾아서 나머지 코드에 영향을 주지 않도록 `캡슐화`한다.
  - 그러면, 코드를 변경하는 과정에서 의도치 않게 발생하는 일을 줄이면서 시스템의 `유연성`을 향상시킬 수 있다.
  - 즉, 코드의 새로운 요구사항이 있을 때마다 바뀌는 부분이 있다면 분리해야 한다.

## 바뀌는 부분과 그렇지 않은 부분 분리하기

- Duck 클래스와 완전히 별개로 2개의 클래스 집합을 만들어야 한다.
  - 나는 것과 관련된 부분, 꽥꽥거리는 것과 관련된 부분
- 각 클래스 집합에는 각각의 행동을 구현한 것을 전부 집어넣는다.


## 오리의 행동을 디자인하는 방법

- 최대한 유연하게 만든다.
- MallardDuck 인스턴스를 새로 만들고 특정 형식의 나는 행동으로 초기화하는 방법
- Duck 클래스에 행동과 관련된 `setter` 메소드를 포함해서 프로그래밍 실행 중에도 행동을 바꿀 수 있게끔 하기
- 디자인 원칙
  - 구현보다는 `인터페이스`에 맞춰서 프로그래밍한다.
  - Duck의 행동은 별도의 클래스 안에 들어있게끔 하고, Duck 클래스에서는 그 행동을 구체적으로 구현할 필요가 없게 된다.

### '인터페이스에 맞춰서 프로그래밍한다'라는 말은 사실 '상위 형식에 맞춰서 프로그래밍한다'라는 말이다

- 인터페이스는 반드시 인터페이스를 사용하라는 뜻이 아니다.
- 상위 형식에 맞춰서 프로그래밍 하라는 원칙은
  - 변수를 선언할 때 `추상클래스`나 `인터페이스` 같은 상위 형식으로 선언해야 한다.
  - 객체를 변수에 대입할 때 상위 형식을 구체적으로 구현한 형식이라면 어떤 객체든 넣을 수 있기 때문이다.
  - 변수를 선언하는 클래스에서 실제 객체의 형식을 몰라도 된다는 의미이다.

### 오리의 행동을 구현하는 방법

- 행동 인터페이스에 맞춰서 -> 이를 구현하는 클래스 따로 구현
- 이런 식으로 디자인하면 다른 형식의 객체에서도 나는 행동과 꽥꽥거리는 행동을 재사용할 수 있다.
  - 그런 행동이 더 이상 Duck 클래스 안에 숨겨져 있지 않기 때문.
- 그리고 기존의 행동 클래스를 수정하거나 날아다니는 행동을 사용하는 Duck 클래스를 전혀 건드리지 않고도 새로운 행동을 추가할 수 있다.
- 따라서 상속을 쓸 때 떠안게 되는 부담을 전부 떨쳐 버리고도 `재사용`의 장점을 그대로 누릴 수 있다.

## 오리 행동 통합하기

- 가장 중요한점
  - 나는 행동과 꽥꽥거리는 행동을 Duck 클래스에서 정의한 메소드를 써서 구현하지 않고 다른 클래스에 `위임`하는 것

### 잠깐만요

- 잠깐만요. 특정 구현에 맞춰서 프로그래밍 하면 안된다고 하지 않았나요?
  - MallarDuck 클래스의 생성자를 보면 Quark 이라는, 구현되어 있는 구상 클래스의 인스턴스를 만들었잖아요!
- 좋은 지적.
  - 실행 시 동적으로 QuarkBehavior를 구현한 다른 클래스를 할당할 수 있게 바꿀 수 있다.
  - 앞으로 더 살펴볼 예정임.

## 캡슐화된 행동 살펴보기

- 지금까지 살펴본 디자인
  - 오리들은 모두 Duck을 확장해서 만들고, 나는 행동은 FlyBehavior를, 꽥꽥거리는 행동은 QuarkBehavior를 구현해서 만든다.
- 이번에는 생각하는 방식을 바꿔보자.
  - 오리의 행동들을 일련의 행동으로 생각하는 대신, 알고리즘군으로 생각하는 것.
- SimUDuck 디자인에서 알고리즘은 오리가 하는 행동을 나타내지만, 지역에 다라 달라지는 세금 계산 방식을 구현하는 클래스에도 활용할 수 있다.
- 클래스 사이의 관계에도 관심을 기울여 보자.
  - 각 화살표와 클래스가 어떤 관계인지 (A는 B이다 / A에는 B가 있다 / A가 B를 구현하는) 관계인지 써보자.

## 두 클래스를 합치는 방법

- `A에는 B가 있다`
  - 각 오리에는 `FlyBehavior`와 `QuarkBehavior`가 있다.
  - 이렇게 두 클래스를 합치는 것을 `구성(composition)을 이용한다라고 부른다.

### 디자인 원칙: 상속보다는 구성을 활용한다

- 구성은 여러 디자인 패턴에서 쓰이며, 앞으로 이 책 전반에 걸쳐서 구성의 장단점을 배운다.

## 첫 번째 디자인 패턴: 전략 패턴

- SimUDuck 애플리케이션을 바꾸는데 활용한 패턴이다.

### 전략 패턴

- `전략패턴(Strategy Pattern)`은 `알고리즘군`을 정의하고 `캡슐화`해서 각각의 알고리즘군을 수정해서 쓸 수 있게 해준다.
- 전략패턴을 사용하면 클라이언트로부터 알고리즘을 분리해서 독립적으로 변경할 수 있다.

## 식당에서 오고 간 이야기

- 주방장과 플로가 공통으로 아는 전문 용어를 썼기 때문에 의사소통 하기가 더 쉬워지고 주방장은 기억해야 할 분량을 줄일 수 있었다.
- 디자인 패턴은 개발자 사이에서 서로 모두 이해할 수 있는 용어를 제공한다.
- 또한, 자질구레한 객체 수준에서의 생각이 아닌, 패턴 수준에서 생각할 수 있기에 아키텍처를 생각하는 수준도 끌어 올려준다.

## 패턴과 전문 용어

- 서로 알고 있는 패턴은 정말 막강하다.
  - 패턴에 담겨 있는 모든 내용, 특성, 제약조건 등을 함께 이야기할 수 있다.
  - 오리들이 다양한 행동을 전략 패턴으로 구현하고 있습니다 라고 얘기한다면 이는 오리들의 행동들을 쉽게 확장하거나 변경할 수 있는 `클래스`들의 집합으로 `캡슐화`되어 있다는 사실을 의미한다.
  - 필요하다면 실행 중에도 `확장과 변경`이 가능하도록 말이다.
- 패턴을 사용하면 간단한 단어로 많은 얘기를 할 수 있다.
- 패턴 수준에서 이야기하면 `디자인`에 더 오랫동안 집중할 수 있다.
- 전문 용어를 사용하면 개발팀의 능력을 극대화할 수 있다.
- 전문 용어는 신입 개발자에게 훌륭한 자극제가 된다.
